!function(){"use strict";class t extends Laya.Script{constructor(){super()}onAwake(){this._arrGround=[this.ground1,this.ground2,this.ground3],this._arrMountains=[this.mountains1,this.mountains2,this.mountains3],this._arrCloud=[this.cloud1,this.cloud2,this.cloud3],this._curGroundIndex=0,this._curMountainsIndex=0,this._curCloudIndex=0,this._curGround=this._arrGround[0],this._curMountains=this._arrMountains[0],this._curCloud=this._arrCloud[0]}SetSpeed(t){this._iSpeed=t,this._iSpeed2=t/5,this._iSpeed3=t/25}Update(){this._curGround.x<=-2040&&(this._curGround.x=4496+this._curGround.x,this._curGroundIndex=2==this._curGroundIndex?0:this._curGroundIndex+1,this._curGround=this._arrGround[this._curGroundIndex]),this._curMountains.x<=-3136&&(this._curMountains.x=6140+this._curMountains.x,this._curMountainsIndex=2==this._curMountainsIndex?0:this._curMountainsIndex+1,this._curMountains=this._arrMountains[this._curMountainsIndex]),this._curCloud.x<=-3436&&(this._curCloud.x=6590+this._curCloud.x,this._curCloudIndex=2==this._curCloudIndex?0:this._curCloudIndex+1,this._curCloud=this._arrCloud[this._curCloudIndex]);for(let t=0;t<3;++t)this._arrGround[t].x-=this._iSpeed,this._arrMountains[t].x-=this._iSpeed2,this._arrCloud[t].x-=this._iSpeed3}}class e extends Laya.Script{constructor(){super()}onAwake(){this._sp=this.owner,this._rigidbody=this.owner.getComponent(Laya.RigidBody),this.Init()}onTriggerEnter(t,e,i){if(-1e4==this._sp.x)return;let s=t.owner;if("Top"!=s.name){if("Coin"==s.name)return this._setCoinHandler.runWith(++this._iCoin),void s.destroy();if("Life"==s.name)return this._setHpHandler.runWith(++this._iLife),void s.destroy();if(!this._bInvincible){if(this._iLife>0)return this._setHpHandler.runWith(--this._iLife),void this.SetInvincible();this.RigidBodyEnable(!1),this._stopCbHandler.run(),this._explosionSP.x=this._sp.x,this._explosionSP.y=this._sp.y,this._explosionAni.play(0,!1),Laya.SoundManager.playSound("sound/explosion.wav"),Laya.timer.once(1e3,this,this.HideExplosion),this._sp.x=-1e4,"Bottom"!=s.name&&s.destroy()}}}HideExplosion(){this._explosionSP.x=-1e4}SetInfo(t,e,i,s,n,a,o){this._setCoinHandler=t,this._setHpHandler=e,this._stopCbHandler=i,this._explosionSP=s,this._explosionAni=n,this._bottomBox=a.getComponent(Laya.BoxCollider),this._bottomBox2=o.getComponent(Laya.BoxCollider),this._bottomBox.enabled=!0,this._bottomBox2.enabled=!1}Init(){this._iCoin=0,this._iLife=0,this._sp.x=959,this._sp.y=539,this.RigidBodyEnable(!1)}Reset(){this._iCoin=0,this._iLife=0,this.Continue()}Continue(){this._sp.x=959,this._sp.y=539,this.RigidBodyEnable(!1),this._bottomBox.enabled=!0,this._bottomBox2.enabled=!1}RigidBodyEnable(t){this._rigidbody.enabled=t}SetInvincible(){this._bInvincible=!0,this._bottomBox.enabled=!1,this._bottomBox2.enabled=!0,Laya.timer.loop(100,this,this.InvincibleEffect),Laya.timer.once(3e3,this,this.ClearInvincible)}InvincibleEffect(){this._sp.visible=!this._sp.visible}ClearInvincible(){Laya.timer.clear(this,this.InvincibleEffect),this._sp.visible=!0,this._bInvincible=!1,this._bottomBox.enabled=!0,this._bottomBox2.enabled=!1}Up(){this._rigidbody.setVelocity({x:0,y:-12})}}class i{constructor(){this._rowData=new Array}SetColKeys(t){this._colKeys=t}AddValue(t){this._rowData.push(t)}GetValue(t){var e;return null==(e=this._colKeys[t])?null:this._rowData[e]}}class s{constructor(){this.m_Data={},this.m_dicColKeys={},this._iColLength=0}AddRow(t,e){e.SetColKeys(this.m_dicColKeys),this.m_Data[t]=e}AddColKey(t){this.m_dicColKeys[t]=this._iColLength++}GetValue(t,e){var i=this.m_Data[t];return null==i?null:i.GetValue(e)}GetRow(t){return this.m_Data[t]}HasRow(t){return null!=this.m_Data[t]}}class n{static Utf8ArrayToStr(t){var e,i,s,n,a,o;for(e="",s=t.length,i=0;i<s;)switch((n=t[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:a=t[i++],e+=String.fromCharCode((31&n)<<6|63&a);break;case 14:a=t[i++],o=t[i++],e+=String.fromCharCode((15&n)<<12|(63&a)<<6|(63&o)<<0)}return e}}class a{static Decrypt(t,e,i=0){var s=t.length;if(!(s<i+2)){var n=s>2*e?e:(s-i)/2,a=i,o=s-n;for(let e=0;e<2;++e){for(let e=0;e<n;++e)t[o++]^=t[a++];a-=n;for(let e=0;e<n;++e)t[a++]^=t[--o];a-=n}}}}class o{static ParseConfig(t){this._configData={};var e=new Uint8Array(t);a.Decrypt(e,20);var h=new Zlib.Gunzip(e).decompress(),r=n.Utf8ArrayToStr(h);for(this._valuePos=0,this._pos=0;this._pos=r.indexOf("------@",this._valuePos),-1!=this._pos;){this._pos+=7;let t=r.indexOf("\n",this._pos),e=r.substring(this._pos,t);try{let n=new s;for(o._configData[e]=n,this._pos=t+1,t=r.indexOf("\n",this._pos),this._bFlag=!0;this._bFlag;)try{n.AddColKey(this.GetNextValue(t,r))}catch(t){console.error(e)}for(t=r.indexOf("\n",this._pos),this._bFlag=!0,this._valuePos=t+1;this._bFlag;){let e=this.GetNextValue(t,r),s=r.indexOf("\n",this._valuePos),a=0,o=new i;for(o.AddValue(e),this._bFlagEx=!0;this._bFlagEx;){let t=this.GetNextValueEx(s,r);t=t.replace("#r","\r\n"),o.AddValue(t),++a}n.AddRow(e,o)}}catch(t){console.error(e)}}}static GetNextValue(t,e){var i=e.indexOf("\t",this._pos);(i>t||-1==i)&&(i=t,this._bFlag=!1);var s=e.substring(this._pos,i);return this._pos=i+1,s}static GetNextValueEx(t,e){var i=e.indexOf("\t",this._valuePos);(i>t||-1==i)&&(i=t,this._bFlagEx=!1);var s=e.substring(this._valuePos,i);return this._valuePos=i+1,s}static GetColKeys(t){return this._configData[t].m_dicColKeys}static GetTable(t){return this._configData[t]}static GetRow(t,e){return this.GetTable(t).GetRow(e)}static GetValue(t,e,i){return this.GetRow(t,e).GetValue(i)}static GetStaticText(t){return this.GetValue("Lan_StaticText_Client",t,"Text")}}class h{}h.g_iSpeed=10,h.LeftX=-500,h.RightX=2420;class r extends Laya.Script{constructor(){super()}static GetInst(){return r._inst}onAwake(){r._inst=this,this._bulletDict={},this._bulletDict.BulletAL=this.bulletPrefabAL,this._bulletDict.BulletBL=this.bulletPrefabBL,this._bulletDict.BulletCL=this.bulletPrefabCL}PopBullet(t){let e=Laya.Pool.getItemByCreateFun(t,this._bulletDict[t].create,this._bulletDict[t]);return this.bulletRoot.addChild(e),e}}class l extends Laya.Script{constructor(){super()}onAwake(){this._sp=this.owner,this._bRunning=!1,this.enabled=!1}Excute(t,e,i,s){this.enabled=!0,this._bRunning=!1,this._bulletName=t,this._iDirection=s,this._sp.x=e,this._sp.y=i,this._iSpeed=s*h.g_iSpeed}Stop(){Laya.Tween.clearAll(this._sp),this._bRunning=!1,this.enabled=!1,this._sp.x=-1e4,this._sp.y=0,Laya.Pool.recover(this._bulletName,this._sp)}}class c extends Laya.Script{constructor(){super()}onAwake(){this._sp=this.owner,this._iState=0,this.enabled=!1}Show(t,e){this.enabled=!0,this._enemyName=t[0],this._iDirection=t[1],this._sp.x=this._iFromX=1==this._iDirection?h.LeftX:h.RightX,this._sp.y=this._iFromY=t[2],this._iToX=t[3],this._iSpeed=10*this._iDirection,this._iState=1}onUpdate(){if(1==this._iState){if(1==this._iDirection){if(this._sp.x+this._iSpeed<this._iToX)return void(this._sp.x+=this._iSpeed)}else if(this._sp.x+this._iSpeed>this._iToX)return void(this._sp.x+=this._iSpeed);this._sp.x=this._iToX,this.ShowCompleted()}else 3==this._iState&&this.BackUpdate()}BackUpdate(){this._sp.x-=this._iSpeed,1==this._iDirection?this._sp.x<this._iFromX&&this.BackCompleted():this._sp.x>this._iFromX&&this.BackCompleted()}ShowCompleted(){this._iState=2,this.BackCompleted()}BackCompleted(){this.enabled=!1,this._iState=0,Laya.Tween.clearAll(this._sp),this._sp.x=-1e4,this._sp.y=0,Laya.Pool.recover(this._enemyName,this._sp)}BulletExcute(t){r.GetInst().PopBullet(t).getComponent(l).Excute(t,this._sp.x,this._sp.y,this._iDirection)}}var _=Laya.Event;class u extends Laya.Script{constructor(){super(),this._iSpeed=0,this._bRunning=!1,this._iWave=0,this._iDistance=0,this._iCoin=0,this._iHp=0,this._sCurWaveDis="",this._curGroupDis=0,this._curGroupTbl=null,this._enemyZName="EnemyZR",this._enemyZInfo=[this._enemyZName,-1,0,h.LeftX]}onAwake(){this._scoreKey="airplaneScore",this.startBtn.visible=!1,this.resultPanel.visible=!1,this.rankPanel.visible=!1,this.openDataViewer.visible=!1,this._enemyDict={},this._enemyDict.EnemyAL1=this.enemyPrefAL1,this._enemyDict.EnemyAL2=this.enemyPrefAL2,this._enemyDict.EnemyBL1=this.enemyPrefBL1,this._enemyDict.EnemyBL2=this.enemyPrefBL2,this._enemyDict.EnemyCL1=this.enemyPrefCL1,this._enemyDict.EnemyCL2=this.enemyPrefCL2,this._enemyDict.EnemyZL=this.enemyPrefZL,this._enemyDict.EnemyZR=this.enemyPrefZR,this._enemyDict.Coin=this.coin,this._enemyDict.Life=this.life,this._hpArr=[this.hp1,this.hp2,this.hp3],this._coinArr=[this.coin1,this.coin2,this.coin3],this.SetCoin(0),this.SetHp(0),Laya.loader.load("cfg/cfg.bin",Laya.Handler.create(this,this.OnConfigComplete),null,Laya.Loader.BUFFER)}OnConfigComplete(i){o.ParseConfig(i),this._enemyTbl=o.GetTable("Enemy_Client"),this.startBtn.clickHandler=new Laya.Handler(this,this.onStartBtnClick),this.restartBtn.clickHandler=new Laya.Handler(this,this.onRestartBtnClick),this.continueBtn.clickHandler=new Laya.Handler(this,this.onContinueBtnClick),this.rankBtn.clickHandler=new Laya.Handler(this,this.onRankBtnClick),this.rankXBtn.clickHandler=new Laya.Handler(this,this.onRankXBtnClick),this.shareBtn.clickHandler=new Laya.Handler(this,this.onShareBtnClick),this.tapSp.on(_.MOUSE_DOWN,this,this.tapSpMouseHandler),this.mainRole=this.mainRoleSp.getComponent(e),this.background=this.backgroundSp.getComponent(t);let s=Laya.LocalStorage.getItem("score");this._iHighestScore=null==s?0:Number(Laya.LocalStorage.getItem("score")),Laya.loader.load(["res/atlas/common.atlas"],Laya.Handler.create(this,()=>{Laya.MiniAdpter.sendAtlasToOpenDataContext("res/atlas/common.atlas")})),this.explosionSp.x=-1e4,this.explosionAni=new Laya.Animation,this.explosionAni.loadAtlas("res/atlas/explosion.atlas",Laya.Handler.create(this,this.ExplosionLoaded)),wx.showShareMenu({success:(res)=>{wx.onShareAppMessage(function(){return{title:'和我一起蛇皮走位吧！',imageUrlId:'L2Uh0yHTSHyc1n5nxbbSsg==',imageUrl:'https://mmocgame.qpic.cn/wechatgame/hW01p7YuN6umLMJYDFlpc3QBFd1qEkpibM47yFy0Tb8fhkrd0bmOHicbAcJjOtKj4k/0'}})}})}ExplosionLoaded(){this.explosionSp.addChild(this.explosionAni),this.explosionSp.scaleX=2,this.explosionSp.scaleY=2,this.explosionAni.interval=100,this.startBtn.visible=!0,this.mainRole.SetInfo(new Laya.Handler(this,this.SetCoin),new Laya.Handler(this,this.SetHp),new Laya.Handler(this,this.Stop),this.explosionSp,this.explosionAni,this.bottomSp,this.bottomSp2)}onUpdate(){this._bRunning&&(this._iDistance+=this._iSpeed,this.distanceText.text=(this._iDistance/1e3).toFixed(1).toString(),this.background.Update(),this.ShowEnemy())}Start(){this._iCoin=0,this._iHp=0,this._iSpeed=5,this.mainRole.Reset(),this.mainRole.RigidBodyEnable(!0),this.background.SetSpeed(this._iSpeed),this._bRunning=!0,Laya.SoundManager.playMusic("sound/bgm.mp3",0)}Continue(){this.mainRole.Continue(),this.mainRole.RigidBodyEnable(!0),this._bRunning=!0,Laya.SoundManager.playMusic("sound/bgm.mp3",0)}Stop(){Laya.SoundManager.stopMusic(),this._bRunning=!1,Laya.timer.once(2e3,this,this.ShowResultPanel),this._iDistance>this._iHighestScore&&(this._iHighestScore=this._iDistance,Laya.LocalStorage.setItem("score",this._iHighestScore.toString()),this.SetUserCloudStorage((this._iHighestScore/1e3).toFixed(1).toString()))}SetCoin(t){this._iCoin=t;for(let e=0;e<3;++e)this._coinArr[e].visible=e<t}SetHp(t){this._iHp=t;for(let e=0;e<3;++e)this._hpArr[e].visible=e<t}SetUserCloudStorage(t){var e=[],i={wxgame:{}};i.wxgame.score=t,i.wxgame.update_time=Laya.Browser.now(),e.push({key:this._scoreKey,value:JSON.stringify(i)}),wx.setUserCloudStorage({KVDataList:e,success:function(t){console.log("-----success:"+JSON.stringify(t))},fail:function(t){console.log("-----fail:"+JSON.stringify(t))},complete:function(t){console.log("-----complete:"+JSON.stringify(t))}})}ShowResultPanel(){this.resultPanel.visible=!0,this.curText.text=(this._iDistance/1e3).toFixed(1).toString(),this.maxText.text=(Number(Laya.LocalStorage.getItem("score"))/1e3).toFixed(1).toString(),this.continueText.text=this.waveText.text,this.continueBtn.gray=this._iCoin<=0}onStartBtnClick(){this.startBtn.visible=!1,this.waveText.text="0",this._iDistance=0,this.Start()}onRestartBtnClick(){this.resultPanel.visible=!1,this.ShowRankPanel(!1),this.SetCoin(0),this.waveText.text="0",this._iDistance=0,this.Start(),this.mainRole.SetInvincible()}onContinueBtnClick(){this._iCoin<=0||(this.resultPanel.visible=!1,this.ShowRankPanel(!1),this.SetCoin(--this._iCoin),this._iDistance=Number(this._sCurWaveDis),this.Continue(),this.mainRole.SetInvincible())}onRankBtnClick(){this.ShowRankPanel(!0)}onRankXBtnClick(){this.ShowRankPanel(!1)}onShareBtnClick(){wx.shareAppMessage({title:'和我一起蛇皮走位吧！',imageUrlId:'L2Uh0yHTSHyc1n5nxbbSsg==',imageUrl:'https://mmocgame.qpic.cn/wechatgame/hW01p7YuN6umLMJYDFlpc3QBFd1qEkpibM47yFy0Tb8fhkrd0bmOHicbAcJjOtKj4k/0'})}ShowRankPanel(t){this.rankPanel.visible=t,this.openDataViewer.visible=t,t?this.openDataViewer.postMsg({type:"RankOpen"}):this.openDataViewer.postMsg({type:"RankClose"})}tapSpMouseHandler(t){if(this._bRunning)switch(t.type){case _.MOUSE_DOWN:this.mainRole.Up()}}ShowEnemy(){this._iDistance%800==0&&this.ShowEnemyZ();let t=this._iDistance.toString();if(this._enemyTbl.HasRow(t)){let e=this._enemyTbl.GetValue(t,"Wave");""!=e&&(this.waveText.text=e,Laya.Tween.from(this.waveText,{scaleX:2,scaleY:2},500,Laya.Ease.backOut)),this._sCurWaveDis=t;let i=this._enemyTbl.GetValue(t,"Group");this._curGroupTbl=o.GetTable(i),this._curGroupDis=this._iDistance}if(0!=this._curGroupDis){let t=(this._iDistance-this._curGroupDis).toString();if(this._curGroupTbl.HasRow(t)){let e,i,s,n=this._curGroupTbl.GetValue(t,"Enemy"),a=JSON.parse(n);for(let t=0;t<a.length;++t){if("Life"==(i=a[t][0]))if(this._iCoin<3)i="Coin";else if(this._iHp>2)continue;e=Laya.Pool.getItemByCreateFun(i,this._enemyDict[i].create,this._enemyDict[i]),this.enemyRoot.addChild(e),(s=e.getComponent(c)).Show(a[t],1e3)}}}}ShowEnemyZ(){let t=Laya.Pool.getItemByCreateFun(this._enemyZName,this._enemyDict[this._enemyZName].create,this._enemyDict[this._enemyZName]);this.enemyRoot.addChild(t),t.getComponent(c).Show(this._enemyZInfo,3e3)}}class d extends l{constructor(){super()}Excute(t,e,i,s){super.Excute(t,e,i,s),this._bRunning=!0}onUpdate(){this._bRunning&&(this._sp.x+=this._iSpeed,(this._sp.x>h.RightX||this._sp.x<h.LeftX)&&this.Stop())}}class p extends l{constructor(){super()}Excute(t,e,i,s){super.Excute(t,e,i,s),Laya.Tween.to(this._sp,{y:i+100},500,Laya.Ease.linearNone,Laya.Handler.create(this,this.DropCompleted))}DropCompleted(){Laya.timer.once(1e3,this,this.Shoot)}Shoot(){this._bRunning=!0}onUpdate(){this._bRunning&&(this._sp.x+=this._iSpeed,(this._sp.x>h.RightX||this._sp.x<h.LeftX)&&this.Stop())}}class y extends l{constructor(){super()}onAwake(){super.onAwake(),this._rigidBody=this.owner.getComponent(Laya.RigidBody),this._rigidBody.enabled=!1}Excute(t,e,i,s){super.Excute(t,e,i,s),this._rigidBody.enabled=!0,this._rigidBody.setVelocity({x:s?12:-12,y:0})}onTriggerEnter(t,e,i){"Bottom"==t.owner.name&&(this._rigidBody.enabled=!1,this.Stop())}}class m extends c{ShowCompleted(){this._iState=2,this._iBulletCount=0,this.Shoot()}Shoot(){Laya.timer.loop(150,this,this._Shoot,[!0]),Laya.timer.once(500,this,this.Back)}Back(){this._iState=3}_Shoot(){super.BulletExcute(1==this._iDirection?"BulletAL":"BulletAR"),++this._iBulletCount>2&&(Laya.timer.clear(this,this._Shoot),this._iBulletCount=0)}}class S extends m{Shoot(){this.__Shoot(),Laya.timer.once(700,this,this.__Shoot),Laya.timer.once(1200,this,this.Back)}__Shoot(){Laya.timer.loop(150,this,this._Shoot)}}class x extends c{ShowCompleted(){this._iState=2,this.Shoot()}Shoot(){this._Shoot(),Laya.timer.once(2e3,this,this.Back)}_Shoot(){super.BulletExcute(1==this._iDirection?"BulletBL":"BulletBR")}Back(){this._iState=3}}class g extends x{Shoot(){this._Shoot(),Laya.timer.once(700,this,this._Shoot),Laya.timer.once(2700,this,this.Back)}}class b extends c{ShowCompleted(){this._iState=2,this.Shoot()}Shoot(){this._Shoot(),this.Back()}_Shoot(){super.BulletExcute(1==this._iDirection?"BulletCL":"BulletCR")}Back(){this._iState=3}BackUpdate(){this._sp.x+=this._iSpeed,1==this._iDirection?this._sp.x>h.RightX&&this.BackCompleted():this._sp.x<h.LeftX&&this.BackCompleted()}}class L extends b{Shoot(){this._Shoot(),Laya.timer.once(500,this,this._Shoot),this.Back()}}class C{constructor(){}static init(){var i=Laya.ClassUtils.regClass;i("script/Background.ts",t),i("script/MainRole.ts",e),i("script/GameControl.ts",u),i("script/BulletControl.ts",r),i("script/bullet/BulletA.ts",d),i("script/bullet/BulletB.ts",p),i("script/bullet/BulletC.ts",y),i("script/enemy/Enemy.ts",c),i("script/enemy/EnemyA.ts",m),i("script/enemy/EnemyA2.ts",S),i("script/enemy/EnemyB.ts",x),i("script/enemy/EnemyB2.ts",g),i("script/enemy/EnemyC.ts",b),i("script/enemy/EnemyC2.ts",L)}}C.width=1920,C.height=1080,C.scaleMode="fixedheight",C.screenMode="horizontal",C.alignV="middle",C.alignH="center",C.startScene="MainScene.scene",C.sceneRoot="",C.debug=!1,C.stat=!1,C.physicsDebug=!1,C.exportSceneToJson=!0,C.init();new class{constructor(){window.Laya3D?Laya3D.init(C.width,C.height):Laya.init(C.width,C.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=C.scaleMode,Laya.stage.screenMode=C.screenMode,Laya.stage.alignV=C.alignV,Laya.stage.alignH=C.alignH,Laya.URL.exportSceneToJson=C.exportSceneToJson,(C.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),C.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),C.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){C.startScene&&Laya.Scene.open(C.startScene,!0,null,Laya.Handler.create(this,t=>{this.resize()})),Laya.stage.on(Laya.Event.RESIZE,this,this.resize)}resize(){let t=C.width,e=C.height;switch(C.scaleMode){case"fixedwidth":let i=Laya.Browser.width/Laya.Browser.height;e=C.width/i;break;case"fixedheight":let s=Laya.Browser.height/Laya.Browser.width;t=C.height/s,Laya.Scene.unDestroyedScenes.forEach(e=>{e.x=(t-C.width)/2})}}}}();